generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  // directUrl = env("DIRECT_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  email     String   @unique
  password  String
  role      Role
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  pengeluaran Pengeluaran[]
}

model Barang {
  id              Int          @id @default(autoincrement())
  namaBarang      String
  hargaBeli       BigInt
  hargaJual       BigInt
  stok            BigInt          @default(0)
  jumlahPerkardus BigInt
  ukuran          BigInt
  satuan          String
  supplier        Supplier     @relation(fields: [supplierId], references: [id])
  supplierId      Int
  pembelianItems  PembelianItem[]
  penjualanItems  PenjualanItem[]
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  isActive       Boolean      @default(true)
}

model Supplier {
  id              Int      @id @default(autoincrement())
  namaSupplier    String
  alamat          String
  noHp            String
  limitHutang     BigInt
  hutang          BigInt      @default(0)
  barang          Barang[]
  pembelian       PembelianHeader[]
  isActive       Boolean  @default(true)
  createdAt       DateTime @default(now())
}

model Customer {
  id            Int      @id @default(autoincrement())
  nik           String   @unique
  nama          String
  alamat        String
  namaToko      String
  noHp          String
  limit_piutang BigInt       @default(0)
  piutang       BigInt       @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  penjualan PenjualanHeader[]
  isActive     Boolean   @default(true)
}

model PembelianHeader {
  id               Int              @id @default(autoincrement())
  kodePembelian    String           @unique
  supplier         Supplier         @relation(fields: [supplierId], references: [id])
  supplierId       Int
  subtotal         BigInt              @default(0)
  diskonNota       BigInt              @default(0)
  totalHarga       BigInt              @default(0)
  jumlahDibayar    BigInt              @default(0)
  kembalian        BigInt              @default(0)
  statusPembayaran StatusPembayaran @default(HUTANG)
  statusTransaksi  StatusTransaksi  @default(KERANJANG)
  items            PembelianItem[]
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  tanggalJatuhTempo DateTime        @default(now())
}

model PembelianItem {
  id              Int             @id @default(autoincrement())
  pembelian       PembelianHeader @relation(fields: [pembelianId], references: [id], onDelete: Cascade)
  pembelianId     Int
  barang          Barang          @relation(fields: [barangId], references: [id])
  barangId        Int
  jumlahDus       BigInt             @default(0)
  hargaPokok      BigInt
  diskonPerItem   BigInt             @default(0)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
}

model PenjualanHeader {
  id                Int              @id @default(autoincrement())
  kodePenjualan     String           @unique
  customer          Customer?        @relation(fields: [customerId], references: [id])
  customerId        Int?
  namaCustomer      String?         
  subtotal          BigInt              @default(0)  // ✅ Changed from Int to BigInt
  diskonNota        BigInt              @default(0)  // ✅ Changed from Int to BigInt
  totalHarga        BigInt              @default(0)  // ✅ Changed from Int to BigInt
  jumlahDibayar     BigInt              @default(0)  // ✅ Changed from Int to BigInt
  kembalian         BigInt              @default(0)  // ✅ Changed from Int to BigInt
  metodePembayaran  MetodePembayaran @default(CASH)
  statusPembayaran  StatusPembayaran @default(HUTANG)
  statusTransaksi   StatusTransaksi  @default(KERANJANG)
  tanggalTransaksi  DateTime         @default(now())
  tanggalJatuhTempo DateTime?
  userId            Int?             
  items             PenjualanItem[]
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
}

model PenjualanItem {
  id             Int              @id @default(autoincrement())
  penjualanId    Int
  barangId       Int
  jumlahDus      BigInt              @default(0)  // ✅ Changed from Int to BigInt
  jumlahPcs      BigInt              @default(0)  // ✅ Changed from Int to BigInt
  hargaJual      BigInt              // ✅ Changed from Int to BigInt
  hargaBeli      BigInt              @default(0)  // ✅ Changed from Int to BigInt
  diskonPerItem  BigInt              @default(0)  // ✅ Changed from Int to BigInt
  laba           BigInt              @default(0)  // ✅ Changed from Int to BigInt
  
  penjualan      PenjualanHeader  @relation(fields: [penjualanId], references: [id], onDelete: Cascade)
  barang         Barang           @relation(fields: [barangId], references: [id])
  
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  @@index([penjualanId])
  @@index([barangId])
}

model Pengeluaran {
  id              Int               @id @default(autoincrement())
  namaPengeluaran String
  jumlah          BigInt
  keterangan      String?        
  tanggalInput    DateTime          @default(now()) 
  updatedAt       DateTime          @updatedAt
  user            User              @relation(fields: [userId], references: [id])
  userId          Int
}

enum MetodePembayaran {
  CASH
  TRANSFER
}

enum StatusPembayaran {
  LUNAS
  HUTANG
}

enum StatusTransaksi {
  KERANJANG
  SELESAI
  DIBATALKAN
}

enum Role{
  ADMIN
  KASIR
}
